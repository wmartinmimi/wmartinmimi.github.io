<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><link rel="icon" type="image/png" href="/favicon.ico"><meta name="viewport" content="width=device-width"><meta name="color-scheme" content="dark"><meta name="darkreader-lock"><link rel="canonical" href="https://wmartinmimi.github.io/blogs/quarkus-imperative-websocket-transaction/"><title>Getting @Transactional to work with Quarkus Websockets</title><style>nav{background-color:#11111b;display:grid;justify-items:center}nav>a,nav>a:visited{color:#a5adce;padding:20px;display:inline-block;text-decoration:none}nav>a:first-child{justify-self:left;grid-row:1}nav>input{display:none}nav>label{display:inline-block;grid-row:1;justify-self:right}nav>label~*{display:none;justify-self:center}nav>input:checked~label~*{display:inline-block;grid-column:span 2}@media (min-width: 840px){nav>label{display:none}nav{display:block}nav>input~a{display:inline-block}nav>input~a.sright~a{float:right}nav>a.current{background-color:#0a0a0e;color:#c6d0f5}}footer{display:block;padding:20px;padding-bottom:30vh;background-color:#11111b}footer hr{border-top:1px solid #cdd6f4}footer *{color:#cdd6f4}#title{display:flex;justify-content:center}#title>div{text-align:center;padding:30px 60px;display:inline-block;margin:0 auto}@media (min-width: 840px){#title>div{margin-top:20px;transform:skew(-25deg);border-radius:5px;background-color:#11111b}#title>div>div{transform:skew(25deg)}}@media (max-width: 840px){#title{background-color:#11111b}}#title>div>div{border-style:dashed none dashed none;margin:0 10px;padding:5px 0}body{background:#0a0a0e;color:#cdd6f4}*{border-color:#f1d151;border-style:none;border-width:3px;margin:0;font-family:JetBrainsMono;font-weight:350}p{margin:20px 0}a{color:#89b4fa}a:visited{color:#cba6f7}h2{color:#b4befe}@font-face{font-family:JetBrainsMono;src:url(/jetbrains-mono.ttf) format("truetype");font-display:swap}div.card{background-color:#110f16;border-radius:5px;backdrop-filter:blur(5px);padding:20px;margin:20px}div.card>hr{border-top:3px dashed #f1d151;width:min(400px,100%);margin-top:5px;margin-bottom:20px}
pre[data-astro-cid-vkvmcqta].astro-code{padding:15px;border-radius:7px}
code[data-astro-cid-4sh76nke].ic{color:#fab387}
</style></head> <body> <nav> <a href="/">Martinmimi</a> <input type="checkbox" id="nav-menu"> <label for="nav-menu">â˜°</label> <a href="/projects">Projects</a><a href="/tools">Tools I use</a><a href="/blogs">Blogs</a><a href="/links" class="sright">Links</a> <a href="https://github.com/wmartinmimi">Github</a> </nav> <div id="title"> <div> <div> <h1>Getting @Transactional to work with Quarkus Websockets</h1> </div> </div> </div>  <div class="card"> <h2>Issue</h2> <hr>  <p><small>Issue as of 2023-07-26.</small></p> <p>Panache entities transactions fail on websocket even with <code class="ic" data-astro-cid-4sh76nke>@Transaction</code> annotated on endpoint with error <code class="ic" data-astro-cid-4sh76nke>BlockingOperationNotAllowedException: Cannot start a JTA transaction from the IO thread</code> in the following code.</p> <p data-astro-cid-vkvmcqta><pre class="astro-code catppuccin-mocha" style="background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;" tabindex="0" data-astro-cid-vkvmcqta data-language="java"><code><span class="line"><span style="color:#FAB387">@Transactional</span></span>
<span class="line"><span style="color:#FAB387">@OnMessage</span></span>
<span class="line"><span style="color:#CBA6F7">public</span><span style="color:#CBA6F7"> void</span><span style="color:#89B4FA;font-style:italic"> onMessage</span><span style="color:#9399B2">(</span><span style="color:#CBA6F7">String</span><span style="color:#CDD6F4"> message</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">  // example transaction stuff...</span></span>
<span class="line"><span style="color:#CBA6F7">  var</span><span style="color:#CDD6F4"> exampleitem </span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7"> new</span><span style="color:#89B4FA;font-style:italic"> ExampleItem</span><span style="color:#9399B2">();</span></span>
<span class="line"><span style="color:#CDD6F4">  exampleitem</span><span style="color:#9399B2">.</span><span style="color:#89B4FA;font-style:italic">persist</span><span style="color:#9399B2">();</span></span>
<span class="line"><span style="color:#9399B2">}</span></span></code></pre></p>  </div> <div class="card"> <h2>Fix</h2> <hr>  <p>The websocket needs to be configured to dispatch to a worker thread.</p> <p data-astro-cid-vkvmcqta><pre class="astro-code catppuccin-mocha" style="background-color:#1e1e2e;color:#cdd6f4; overflow-x: auto;" tabindex="0" data-astro-cid-vkvmcqta data-language="properties"><code><span class="line"><span style="color:#6C7086;font-style:italic"># src/main/resources/application.properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># add following line</span></span>
<span class="line"><span style="color:#89B4FA">quarkus.websocket.dispatch-to-worker</span><span style="color:#94E2D5"> =</span><span style="color:#CDD6F4"> true</span></span></code></pre></p> <p>Hope this is helpful to you.</p>  </div>  <footer> <hr> <p><small>This website is still very much under construction.</small></p> <p><small>Copyright &copy; 2024 Martinmimi &lt;3</small></p> </footer> </body></html>